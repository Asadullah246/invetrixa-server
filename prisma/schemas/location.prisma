enum LocationType {
  WAREHOUSE
  STORAGE
}

enum LocationSubType {
  ONLINE
  PHYSICAL
  HYBRID
}

enum LocationStatus {
  ACTIVE
  INACTIVE
  CLOSED
}

model Location {
  id   String  @id @default(uuid())
  name String  @db.VarChar(255)
  code String? @db.VarChar(50) // Short code for reference (e.g., "WH-01")

  type    LocationType    @default(WAREHOUSE)
  subType LocationSubType @default(PHYSICAL)

  email           String         @unique @db.VarChar(255)
  phone           String         @unique @db.VarChar(20)
  businessHours   String         @default("9:00 AM - 5:00 PM") @db.VarChar(255)
  totalCapacity   Int?
  status          LocationStatus @default(ACTIVE)
  establishedYear DateTime       @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // User assignments
  userAssignment UserAssignment[]

  // Stock management relations
  inventoryBalances InventoryBalance[]
  valuationLayers   ValuationLayer[]
  stockMovements    StockMovement[]
  stockReservations StockReservation[]

  // Transfer relations
  transfersFrom StockTransfer[] @relation("TransferFrom")
  transfersTo   StockTransfer[] @relation("TransferTo")

  // POS relations
  posTerminals        POSTerminal[]       @relation
  sales               Sale[]              @relation
  dailySalesSummaries DailySalesSummary[] @relation
  invoices            Invoice[]           @relation

  createdByUserId String?
  createdBy       User?   @relation(name: "location_created_by_user", fields: [createdByUserId], references: [id])

  // Tenant relation
  tenantId String
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  address  Address?

  @@unique([code, tenantId])
  @@index([tenantId])
  @@index([email])
  @@index([phone])
  @@index([createdByUserId])
  @@map("locations")
}
